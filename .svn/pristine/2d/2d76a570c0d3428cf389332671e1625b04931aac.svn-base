<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="DataAvgDayCharts.aspx.cs" Inherits="SmartEP.WebUI.Pages.EnvAir.DataAnalyze.DataAvgDayCharts" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
</head>
<body>
    <form id="form1" runat="server">
        <script type="text/javascript">
            function GetParentData() {
                var parentData = window.parent.GetData();
                document.getElementById("hdPointId").value = parentData.pointIds;
                document.getElementById("hdDtStart").value = parentData.dtStart;
                document.getElementById("hdDtEnd").value = parentData.dtEnd;
                document.getElementById("hdPointType").value = parentData.pointType;
            }
            function SaveData() {
                var buttonSave = document.getElementById("btnSave");
                buttonSave.click();
            }

        </script>
        <script src="../../../Resources/JavaScript/JQuery/jquery-1.9.0.min.js"></script>
        <script src="../../../Resources/JavaScript/Highcharts/highcharts.js"></script>
        <script src="../../../Resources/JavaScript/ChartOperator/ShowChart.js"></script>
        <script src="../../../Resources/JavaScript/ChartOperator/merge.js"></script>
        <script src="../../../Resources/JavaScript/Highcharts/highcharts-more.js"></script>
        <script type="text/javascript">
            $(function () {
                InitTogetherChart();
            });
            function InitTogetherChart() {
                var windowHeight = document.body.clientHeight;//网页可见区域高 屏幕可用工作区高度：window.screen.availHeight 
                var windowWidth = document.body.clientWidth;
                var divDataEffectRateHeight = (windowHeight - 70).toString() + "px";
                var divDataEffectRateWidth = (windowWidth).toString() + "px";
                document.getElementById("container").style.height = divDataEffectRateHeight;
                document.getElementById("container").style.width = divDataEffectRateWidth;
                $("#container").html("");

                var seriesOptions = [];
                var strData = [];

                createChart = function () {
                    Highcharts.setOptions({

                        lang: {
                            rangeSelectorZoom: ''    //隐藏Zoom
                        }
                    });
                    $('#container').highcharts({
                        chart: {
                            type: 'boxplot'
                        },

                        title: {
                            text: ''
                        },

                        legend: {
                            enabled: true
                        },

                        xAxis: {
                            categories: strData,
                            title: {
                                text: ''
                            }
                        },

                        yAxis: {
                            title: {
                                text: ''
                            },
                            plotLines: [{
                                value: 932,
                                color: 'red',
                                width: 1,
                                label: {
                                    text: 'Theoretical mean: 932',
                                    align: 'center',
                                    style: {
                                        color: 'gray'
                                    }
                                }
                            }]
                        },

                        series: seriesOptions
                    })
                };
                var heavyMetalMonitor = $("#hdpointiddata").val();
                var hiddenData = $("#hdPointNames").val();
                var FactorNamejson = $("#hdFactorName").val();
                var allData = [];
                var effectData = JSON.parse(heavyMetalMonitor);
                var diameter = JSON.parse(hiddenData);
                var FactorName = JSON.parse(FactorNamejson);
                //strData = diameter;
                //strData.push(parseFloat(diameter[i]));
                $.each(diameter, function (key, obj) {

                    strData.push(obj.RegionName);
                });
                var i = 0;
                $.each(FactorName, function (key, obj) {
                    var pointobj = new Object();

                    pointobj.data = [];

                    $.each(diameter, function (key, obj1) {
                        pointobj.name = obj.FactorName;
                        $.each(effectData, function (key, obj2) {
                            if (obj2.FactorName == obj.FactorName && obj1.RegionName == obj2.RegionName) {
                                var data = [];
                                if (obj2.lower == null || obj2.lower == "" || obj2.MedianLower == null || obj2.MedianLower == "" || obj2.MedianValueu == null || obj2.MedianValueu == "" || obj2.MedianUpper == null || obj2.MedianUpper == "" || obj2.upper == null || obj2.upper == "") {
                                    data.push(null, null, null, null, null);
                                } else {
                                    data.push(parseFloat(obj2.lower), parseFloat(obj2.MedianLower), parseFloat(obj2.MedianValueu), parseFloat(obj2.MedianUpper), parseFloat(obj2.upper));
                                }
                                pointobj.data.push(data);
                            }

                        });

                    });
                    seriesOptions.push(pointobj);
                });
                //seriesOptions[0] = {
                //    type: 'column',
                //    name: "3772L(nm)",
                //    data: allData,
                //    pointStart: 1,
                //    zIndex: 1,
                //    yAxis: 0
                //}
                createChart();
            }
        </script>
        <table style="width: 100%; display: none" class="Table_Customer">
            <tr class="btnTitle">
                <td class="btnTitle">
                    <asp:ImageButton ID="btnSave" runat="server" OnClick="btnSave_Click" OnClientClick="GetParentData()" SkinID="ImgBtnSave" />
                </td>
            </tr>
        </table>
        <telerik:RadScriptManager ID="RadScriptManager1" runat="server" />
        <telerik:RadSplitter ID="splitter" runat="server" Orientation="Horizontal" Height="100%" BorderWidth="0" BorderSize="0" BorderStyle="None"
            Width="100%">
            <telerik:RadPane ID="paneImage" runat="server" Width="100%" Height="100%" Scrolling="None"
                BorderWidth="0" BorderStyle="None" BorderSize="0">
                <!--Step:1 Prepare a dom for ECharts which (must) has size (width & hight)-->
                <!--Step:1 为ECharts准备一个具备大小（宽高）的Dom-->
                <div id="container" style="height: 80%; border-width: 0px; border-style: none;"></div>
                <asp:HiddenField ID="hdpointiddata" runat="server" />
                <asp:HiddenField ID="hdPointNames" runat="server" />
                <asp:HiddenField ID="hdFactorName" runat="server" />

                <asp:HiddenField ID="hdPointId" runat="server" />
                <asp:HiddenField ID="hdDtStart" runat="server" />
                <asp:HiddenField ID="hdDtEnd" runat="server" />
                <asp:HiddenField ID="hdPointType" runat="server" />
            </telerik:RadPane>
        </telerik:RadSplitter>
    </form>
</body>
</html>
